apiVersion: "nuclio.io/v1"
kind: Function
metadata:
  name: mqtt-planeproducer
  namespace: nuclio
spec:
  handler: "main:handler"
  description: "PLANE PRODUCER"
  runtime: nodejs
  image: "nuclio/planeproducer:latest"
  minReplicas: 1
  maxReplicas: 1
  targetCPU: 75
  build:
    functionSourceCode: dmFyIG1xdHQgPSByZXF1aXJlKCdtcXR0JyksIHVybCA9IHJlcXVpcmUoJ3VybCcpOwovLyBucG0gcGFja2FnZSB0byBtYW5hZ2UgYWlycGxhbmVzCnZhciBQbGFuZSA9IHJlcXVpcmUoJ3BsYW5lcy1nZW5lcmF0b3InKTsKCnZhciBtcXR0X3VybCA9IHVybC5wYXJzZShwcm9jZXNzLmVudi5DTE9VREFNUVBfTVFUVF9VUkwgfHwgJ21xdHQ6Ly9ndWVzdDpndWVzdEAxOTIuMTY4LjEuNzoxODgzJyk7CnZhciBhdXRoID0gKG1xdHRfdXJsLmF1dGggfHwgJzonKS5zcGxpdCgnOicpOwp2YXIgdXJsID0gIm1xdHQ6Ly8iICsgbXF0dF91cmwuaG9zdDsKCnZhciBvcHRpb25zID0gewogIHBvcnQ6IG1xdHRfdXJsLnBvcnQsCiAgY2xpZW50SWQ6ICdtcXR0anNfJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpLnN1YnN0cigyLCA4KSwKICB1c2VybmFtZTogYXV0aFswXSwKICBwYXNzd29yZDogYXV0aFsxXSwKfTsKCi8vIEhlcmUgd2UgcHV0IHRoZSBsb2dpYyB0byBzaW11bGF0ZSB0aGUgYXBwcm9hY2hpbmcgb2YgdGhlIHBsYW5lIHRvIGFpcnBvcnQhCmV4cG9ydHMuaGFuZGxlciA9IGZ1bmN0aW9uKGNvbnRleHQsIGV2ZW50KSB7CgogICAgLy9HZW5lcmF0ZSBhIG5ldyBwbGFuZSBmcm9tIHNjcmF0Y2gKICAgIHZhciBjdXJyZW50UGxhbmUgPSBuZXcgUGxhbmUoKTsKICAgIAogICAgLy8gc2VuZHMgYSBmZWVkYmFjayBvZiB0aGUgcGxhbmUgc3RhdHVzIAogICAgZnVuY3Rpb24gaXRlcmF0ZVNlbmRpbmcgKCl7CiAgICAgICAgdmFyIGNsaWVudCA9IG1xdHQuY29ubmVjdCh1cmwsIG9wdGlvbnMpOyAgCiAgICAgICAgY2xpZW50Lm9uKCdjb25uZWN0JywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGNsaWVudC5wdWJsaXNoKCdpb3QvcGxhbmVzL2Fycml2YWxzJywgY3VycmVudFBsYW5lLnRvU3RyaW5nKCksIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgY2xpZW50LmVuZCgpOyAgCiAgICAgICAgICAgICAgICBjb250ZXh0LmNhbGxiYWNrKCdNUVRUIE1lc3NhZ2UgU2VudCcpOwogICAgICAgICAgICB9KTsgICAKICAgICAgICB9KTsKICAgICAgICAvLyBkZWNyZWFzZSB0aGUgZnVlbCBsZXZlbCBhdCBlYWNoIGZlZWRiYWNrIHRvIHNpbXVsYXRlIHRoZSBmdWVsIGNvbnN1bXB0aW9uCiAgICAgICAgY3VycmVudFBsYW5lLmRlY3JlYXNlRnVlbExldmVsKCk7CiAgICB9CgogICAgaXRlcmF0ZVNlbmRpbmcoKTsKICAgIC8vIHNldEludGVydmFsIGV4ZWN1dGUgdGhlIGl0ZXJhdGVTZW5kaW5nIGZ1bmN0aW9uIGV2ZXJ5IGZpdmUgc2Vjb25kcyB1bnRpbCBjbGVhckludGVydmFsIEludm9jYXRpb24KICAgIHZhciB0aW1lciA9IHNldEludGVydmFsKGl0ZXJhdGVTZW5kaW5nLCA1KjEwMDApOwoKICAgIC8vIFRoaXMgZnVuY3Rpb24gY2F1c2VzIHRoZSBjb2RlIHBhc3NlZCBhcyB0aGUgZmlyc3QgcGFyYW1ldGVyIHRvIGJlIGV4ZWN1dGVkIGFmdGVyIDYwIHNlY29uZHMKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgLy8gU3RvcHMgdGhlIHNldEludGVydmFsIHJlY3VycmVudCBpbnZvY2F0aW9ucwogICAgICAgIGNsZWFySW50ZXJ2YWwodGltZXIpOwogICAgICAgIC8vIFRoZSBjdXJyZW50IHBsYW5lIGxhbmRzCiAgICAgICAgY3VycmVudFBsYW5lLmxhbmQoKTsKICAgICAgICAvLyBnZW5yYXRlcyBzb21lIGlzc3VlcwogICAgICAgIGN1cnJlbnRQbGFuZS5wcm9kdWNlVGlyZXNJc3N1ZXMoKTsKICAgICAgICBjdXJyZW50UGxhbmUucHJvZHVjZUNhc3VhbElzc3VlcygpOwogICAgICAgIHZhciBjbGllbnQgPSBtcXR0LmNvbm5lY3QodXJsLCBvcHRpb25zKTsgIAogICAgICAgIGNsaWVudC5vbignY29ubmVjdCcsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAvLyBwdWJsaXNoIHRoZSBpbmZvcm1hdGlvbnMgb24gdGhlIG1haW4gbXF0dCB0b3BpYyBpb3QvcGxhbmVzL2Fycml2YWxzCiAgICAgICAgICAgIGNsaWVudC5wdWJsaXNoKCdpb3QvcGxhbmVzL2Fycml2YWxzJywgY3VycmVudFBsYW5lLnRvU3RyaW5nKCksIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgY2xpZW50LmVuZCgpOyAgCiAgICAgICAgICAgICAgICBjb250ZXh0LmNhbGxiYWNrKCdNUVRUIE1lc3NhZ2UgU2VudCcpOwogICAgICAgICAgICB9KTsgICAKICAgICAgICB9KTsKICAgIH0sIDYwMDAwKTsKICAKfTs=

    commands:
      - 'npm install mqtt'
      - 'npm i planes-generator'
    codeEntryType: sourceCode
  platform: {}
  